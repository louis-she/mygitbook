## python 并发模型踩过的坑

### threading


* **实际是单线程**，threading模块虽然是多线程，不过会限制于python的全局锁，同一时间实际上不能同时执行多个线程的代码，类似于单核CPU的机制，所以该模块也无法利用上多核CPU的优势。
* **python C扩展代码的执行不会释放全局锁** 如果某个threading中在跑的代码中包含C扩展程序，则python不会在各个thread之间切换，必须在扩展代码执行完毕后才能执行别的线程，不过在python C扩展中，可以手动释放全局锁，一般扩展会在较长的IO操作之前释放掉全局锁。
* **可以使用Queue模块做队列** 多线程之间由于共享全局变量，所以可以定义一个全局的Queue来交换数据


### multiprocessing

* **多进程** 多进程可以利用多核CPU。
* **不受于全局锁** 全局锁只局限于单个进程。
* **数据交换** 多进程的数据交换和Linux的进程间通信一样，pipe和信号量等，multiprocessing模块内置了一个Queue类可以用来实现跟 Queue 模块类似的功能，其内部实现是信号量。


所以在做并发程序时，比较推荐的还是使用**multipocessing**模块，这样可以最大化得发挥机器的性能。
